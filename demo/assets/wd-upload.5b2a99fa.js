import{d as e,r as s,T as a,h as t,j as o,o as l,c as i,w as n,p as r,a as u,n as c,y as d,ac as m,i as p,L as f,ad as v,ae as y,q as h,v as _,e as b,F as w,f as g,b as k,t as C,u as F,x,l as z,g as T,af as P,X as L,z as D,H as I,ag as M}from"./index-a29608c3.js";import{g as N,c as j,b as E,r as S,K as U,i as K,l as A,m as R,o as $,P as H,Z as G,C as O,Q as X,$ as q,a0 as Q}from"./page-wraper.b2442bab.js";import{u as V}from"./useTranslate.deea6125.js";const Z=E(e({name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...N},setup(e,{expose:f}){const v=s(!1),y=a({url:"",poster:"",title:""});function h(){v.value=!1}return f({open:function(e){v.value=!0,y.url=e.url,y.poster=e.poster,y.title=e.title},close:h}),(e,s)=>{const a=m,f=t(o("wd-icon"),j),_=p;return v.value?(l(),i(_,{key:0,class:c(`wd-video-preview ${e.customClass}`),style:d(e.customStyle)},{default:n((()=>[y.url?(l(),i(a,{key:0,class:"wd-video-preview__video",controls:!0,poster:y.poster,title:y.title,"play-btn-position":"center",enableNative:!0,src:y.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):r("",!0),u(f,{name:"close-circle",size:"48px","custom-class":"wd-video-preview__close",onClick:h})])),_:1},8,["class","style"])):r("",!0)}}}),[["__scopeId","data-v-7cb10891"]]);function B(e){if(S(e.tempFiles)){const s=[];return e.tempFiles.forEach((async e=>{s.push({path:e.path||"",name:e.name||"",size:e.size,type:"image",thumb:e.path||""})})),s}return[{path:e.tempFiles.path||"",name:e.tempFiles.name||"",size:e.tempFiles.size,type:"image",thumb:e.tempFiles.path||""}]}const J=E(e({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...N,fileList:U(),action:K(""),header:{type:Object,default:()=>{}},multiple:A(!1),disabled:A(!1),limit:Number,showLimitNum:A(!0),maxSize:R(Number.MAX_VALUE),sourceType:{type:Array,default:()=>["album","camera"]},sizeType:{type:Array,default:()=>["original","compressed"]},name:K("file"),formData:{type:Object,default:()=>{}},onPreviewFail:Function,beforeUpload:Function,beforeChoose:Function,beforeRemove:Function,beforePreview:Function,buildFormData:Function,loadingType:K("ring"),loadingColor:K("#ffffff"),accept:K("image"),statusKey:K("status"),loadingSize:K("24px"),compressed:A(!0),maxDuration:R(60),camera:K("back"),customEvokeClass:K(""),customPreviewClass:K(""),imageMode:K("aspectFit")},emits:["fail","change","success","progress","oversize","chooseerror","remove"],setup(e,{emit:a}){const N=e,{translate:E}=V("upload"),S=s([]),U=h((()=>!N.limit||S.value.length<N.limit)),K=s();function A(e){return new Promise(((s,a)=>{I({src:e,success:e=>{s(e)},fail:e=>{a(e)}})}))}function R(e){const s={uid:G.id++,name:e.name||"",thumb:e.thumb||"",status:"loading",size:e.size||0,url:e.path,percent:0};S.value.push(s);const{buildFormData:a,formData:t={}}=N;a?a({file:s,formData:t,resolve:e=>{e&&W(s,e)}}):W(s,t)}function J(e,s,t){const{statusKey:o}=N,l=S.value.findIndex((e=>e.uid===s.uid));l>-1&&(S.value[l][o]="fail",S.value[l].error=e.message,S.value[l].response=e,a("fail",{error:e,file:s,formData:t}))}function W(e,s){const{action:t,name:o,header:l={},accept:i}=N;M({url:t,header:l,name:o,fileName:o,fileType:i,formData:s,filePath:e.url,success(t){200===t.statusCode?function(e,s,t){const{statusKey:o}=N,l=S.value.findIndex((e=>e.uid===s.uid));l>-1&&(S.value[l][o]="success",S.value[l].response=e.data,a("change",{fileList:S.value}),a("success",{file:s,fileList:S.value,formData:t}))}(t,e,s):J(t,e,s)},fail(a){J(a,e,s)}}).onProgressUpdate((s=>{!function(e,s){const t=S.value.findIndex((e=>e.uid===s.uid));t>-1&&(S.value[t].percent=e.progress,a("progress",{response:e,file:s}))}(s,e)}))}function Y(){const{multiple:e,maxSize:s,accept:t,sizeType:o,limit:l,sourceType:i,compressed:n,maxDuration:r,camera:u,beforeUpload:c}=N;(function({multiple:e,sizeType:s,sourceType:a,maxCount:t,accept:o,compressed:l,maxDuration:i,camera:n}){return new Promise(((r,u)=>{switch(o){case"image":f({count:e?Math.min(t,9):1,sizeType:s,sourceType:a,success:e=>r(B(e)),fail:e=>{u(e)}});break;case"video":y({sourceType:a,compressed:l,maxDuration:i,camera:n,success:e=>{r(function(e){return[{path:e.tempFilePath||e.filePath||"",name:e.name||"",size:e.size,type:"video",thumb:e.thumbTempFilePath||"",duration:e.duration}]}(e))},fail:u});break;case"all":v({count:e?Math.min(t,100):1,type:o,success:e=>r(e.tempFiles),fail:u});break;default:f({count:e?Math.min(t,9):1,sizeType:s,sourceType:a,success:e=>r(B(e)),fail:u})}}))})({multiple:e,sizeType:o,sourceType:i,maxCount:l?l-S.value.length:9,accept:t,compressed:n,maxDuration:r,camera:u}).then((t=>{let o=t;e||(o=o.slice(0,1));const l=async e=>{for(let t=0;t<e.length;t++){const o=e[t];if("image"===o.type&&!o.size){const e=await A(o.path);o.size=e.width*e.height}Number(o.size)<=s?R(o):a("oversize",{file:o})}};c?c({files:o,fileList:S.value,resolve:e=>{e&&l(o)}}):l(o)})).catch((e=>{a("chooseerror",{error:e})}))}function ee(){if(N.disabled)return;const{beforeChoose:e}=N;e?e({fileList:S.value,resolve:e=>{e&&Y()}}):Y()}function se(e,s){S.value.splice(S.value.findIndex((s=>s.uid===e.uid)),1),a("change",{fileList:S.value}),a("remove",{file:e})}function ae(e){P({filePath:e.url,showMenu:!0})}function te(e,s){const{onPreviewFail:a}=N;L({urls:s,current:s[e],fail(){a?a({index:e,imgList:s}):D({title:"预览图片失败",icon:"none"})}})}function oe(e,s){var a;null==(a=K.value)||a.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function le(e){const{beforePreview:s}=N,a=S.value.filter((e=>ie(e))),t=a.findIndex((s=>s.url===e.url));s?s({index:t,imgList:[],resolve:e=>{e&&oe(t,a)}}):oe(t,a)}function ie(e){return e.name&&q(e.name)||q(e.url)}function ne(e){return e.name&&Q(e.name)||Q(e.url)}return _((()=>N.fileList),(e=>{const{statusKey:s}=N;if(H(e,S.value))return;const a=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",{...e,uid:G.id++})));S.value=a}),{deep:!0,immediate:!0}),_((()=>N.limit),(e=>{e&&e<S.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),_((()=>N.beforePreview),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),_((()=>N.onPreviewFail),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),_((()=>N.beforeRemove),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),_((()=>N.beforeUpload),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),_((()=>N.beforeChoose),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),_((()=>N.buildFormData),(e=>{e&&!O(e)&&"asyncfunction"!==X(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const a=z,f=t(o("wd-icon"),j),v=p,y=m,h=t(o("wd-loading"),$),_=T,P=t(o("wd-video-preview"),Z);return l(),b(w,null,[u(v,{class:c(["wd-upload",e.customClass]),style:d(e.customStyle)},{default:n((()=>[(l(!0),b(w,null,g(S.value,((s,t)=>(l(),i(v,{class:c(["wd-upload__preview",e.customPreviewClass]),key:t},{default:n((()=>[u(v,{class:"wd-upload__status-content"},{default:n((()=>[ne(s)?(l(),i(a,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s}=N,a=S.value.filter((e=>ne(e))).map((e=>e.url));s?s({index:e,imgList:a,resolve:s=>{s&&te(e,a)}}):te(e,a)}(t)},null,8,["src","mode","onClick"])):ie(s)?(l(),b(w,{key:1},[s.thumb?(l(),i(v,{key:0,class:"wd-upload__video",onClick:e=>le(s)},{default:n((()=>[u(a,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),u(f,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(l(),i(v,{key:1,class:"wd-upload__video",onClick:e=>le(s)},{default:n((()=>[u(y,{src:s.url,title:s.name||"视频"+t,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),u(f,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(l(),i(v,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s}=N,a=S.value.filter((e=>!ie(e)&&!ne(e))).findIndex((s=>s.url===e.url));s?s({index:a,imgList:[],resolve:s=>{s&&ae(e)}}):ae(e)}(s)},{default:n((()=>[u(f,{name:"file",size:"22px"}),u(v,{class:"wd-upload__file-name"},{default:n((()=>[k(C(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s.status?(l(),i(v,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:n((()=>["loading"===s.status?(l(),i(v,{key:0,class:"wd-upload__status-content"},{default:n((()=>[u(h,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),u(_,{class:"wd-upload__progress-txt"},{default:n((()=>[k(C(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):r("",!0),"fail"===s.status?(l(),i(v,{key:1,class:"wd-upload__status-content"},{default:n((()=>[u(f,{name:"close-outline","custom-class":"wd-upload__icon"}),u(_,{class:"wd-upload__progress-txt"},{default:n((()=>[k(C(s.error||F(E)("error")),1)])),_:2},1024)])),_:2},1024)):r("",!0)])),_:2},1024)):r("",!0),"loading"===s.status||e.disabled?r("",!0):(l(),i(f,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=N,a=e,t=S.value[a];s?s({file:t,index:a,fileList:S.value,resolve:e=>{e&&se(t)}}):se(t)}(t)},null,8,["onClick"]))])),_:2},1032,["class"])))),128)),F(U)?(l(),b(w,{key:0},[e.$slots.default?(l(),i(v,{key:0,class:c(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:ee},{default:n((()=>[x(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(l(),i(v,{key:1,onClick:ee,class:c(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:n((()=>[u(f,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(l(),i(v,{key:0,class:"wd-upload__evoke-num"},{default:n((()=>[k("（"+C(S.value.length)+"/"+C(e.limit)+"）",1)])),_:1})):r("",!0)])),_:1},8,["class"]))],64)):r("",!0)])),_:3},8,["class","style"]),u(P,{ref_key:"videoPreview",ref:K},null,512)],64)}}}),[["__scopeId","data-v-8b012791"]]);export{J as _};
